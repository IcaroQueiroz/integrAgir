import pandas as pd
from itertools import combinations
from PyQt5.QtWidgets import QFileDialog, QMessageBox
from datetime import datetime

from openpyxl import Workbook
from openpyxl.styles import Font



def criar_planilha_com_cabecalhos(nome_arquivo):
    # Criar uma nova planilha
    wb = Workbook()

    # Adicionar uma nova folha
    ws = wb.active

    # Cabeçalhos
    cabecalhos = [
        "Código do Fornecedor", "Nome Fornecedor", "CNPJ do Fornecedor", "Nota Fiscal", "Quantidade",
        "Patrimônio", "Data da Abertura", "Vida Útil", "Código da Conta Contábil", "Descrição do Bem",
        "Código do Centro de Custo", "Data da Entrada da Compra", "Data da Aquisição", "Valor Total da NF",
        "Base de Cálculo", "Aliquota", "Crédito de ICMS", "ICMS Adicional", "Valor do Mês", "Valor Alocado",
        "Código da Conta de Despesa da Depreciação", "SALDO DE ABERTURA", "CIAP", "ICMS Frete", "ICMS ST",
        "ICMS DIF", "Código da Conta de Depreciação Acumulada", "Valor Depreciado", "Código da Localização",
        "Parcelas CIAP", "Série", "Vida Útil em Meses", "Observações", "Tipo de Depreciação(0 - Fiscal, 1 - IFRS)",
        "Depreciar no Mês Seguinte(0 - Não, 1 - Sim)", "CPC - Natureza da BC Pis/Cofins", "CPC - Identificação dos Bens/Grupos",
        "CPC - Indicador de Origem do Bem", "CPC - CST Pis", "CPC - CST Cofins", "CPC - Indicador da Utilização do Bens",
        "CPC - Conta Contábil", "CPC - Indicador do Número de Parcelas", "CPC - Número de Parcelas",
        "CPC - Parcela a Excluir da B/C"
    ]

    # Adicionar cabeçalhos à nova planilha
    for col_num, cabecalho in enumerate(ws.iter_cols(min_col=1, max_col=len(cabecalhos), min_row=1, max_row=1), start=1):
        coluna_letra = cabecalho[0].column_letter
        coluna_letra = coluna_letra.upper()
        coluna_letra = coluna_letra[:2] if len(coluna_letra) > 2 else coluna_letra
        coluna_letra = coluna_letra.strip()

        cabecalho[0].font = Font(bold=True)
        cabecalho[0].value = f"{coluna_letra} -> {cabecalho[0].value}"

    # Salvar a nova planilha
    wb.save(nome_arquivo)


def abrir_planilha(nome_arquivo):
    # Carrega a planilha
    df = pd.read_excel(nome_arquivo, skiprows=2)  # Pula as duas primeiras linhas (considerando que a linha 3 seja a terceira)

    # Exibe o conteúdo da planilha a partir da linha 3
    print(df)

arquivo_excel = r'C:\Users\Icaro\Desktop\Develop\integrAgir\exemplos\Relatório da consulta.xlsx'
arquivo_excel_salvar = r'C:\Users\Icaro\Desktop\Develop\integrAgir\exemplos\Relatório da ativo.xlsx'
abrir_planilha(arquivo_excel)
criar_planilha_com_cabecalhos(arquivo_excel_salvar)

"""class AppAthenas():
    def Athenas(self):
        try:
                 

            QMessageBox.warning(self, 'Info', 'Excel carregado com Sucesso')  
        except KeyError as erro:
            QMessageBox.warning(self, 'KeyError', 'Não foi localizado a coluna: '+ str(erro))
        except ValueError as erro:
            QMessageBox.warning(self, 'ValueError', 'Retire os filtros da planilha.    ')                   
        except Exception as erro:
            QMessageBox.warning(self, 'Error', 'Erro ao tentar carregar o aquivo. - '+ str(erro))    
"""